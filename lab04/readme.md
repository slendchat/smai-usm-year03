# Лабораторная работа №4

## Анализ и расширенная визуализация данных в Zabbix

## Цель работы

В этой работе я изучаю расширенные функции Zabbix. Я учусь создавать шаблоны, добавлять метрики, строить графики, анализировать данные, настраивать уведомления и оптимизировать сбор информации.

## Задача

Я выполняю все этапы мониторинга: создаю элементы данных, связываю их с хостами, делаю вычисляемые метрики, строю графики и настраиваю действия.
Я работаю на сервере Zabbix, который я настроил ранее. Хост с Zabbix Agent у меня уже есть, и доступ в веб‑интерфейс я использую для настройки.

---

## 1. Создание собственного шаблона

**![\[ШАГ 1\]](img/step1.png)**

Сначала я создаю свой шаблон **Template IT-System-Monitoring**. Я добавляю в него основные метрики, которые помогают наблюдать состояние системы: загрузку CPU (avg1, avg5, avg15), использование RAM, заполнение диска и сетевой трафик. Долго искал, где добавить триггер «High load», который срабатывает, если загрузка процессора больше 2 в течение 5 минут.

Я делаю это через меню *Configuration - Templates - Create template*. Затем перехожу в раздел Items и по очереди создаю все нужные элементы. После этого открываю раздел Triggers и создаю триггер, указывая условие.

---

## 2. Применение шаблона к хосту

Далее я беру свой шаблон и привязываю его к хосту, который уже мониторится. Я делаю это через *Configuration - Hosts*, выбираю нужный хост и добавляю шаблон через раздел Templates. После сохранения я проверяю, что данные начали собираться.

---

## 3. Зависимые и вычисляемые элементы

**![\[ШАГ 3\]](img/step3.png)**

Теперь я создаю дополнительные типы элементов.

### Calculated item

Я создаю вычисляемый элемент, который показывает отношение RAM Used % к CPU Load avg5. Я использую выражение:

```
{Template IT-System-Monitoring:ram.used.last()} / {Template IT-System-Monitoring:system.cpu.load[all,avg5].last()}
```

Я делаю это через *Items - Create item*, выбирая тип Calculated.

### Dependent item

Следом я создаю зависимый элемент. Для этого я сначала добавляю master‑item, который получает сырое текстовое значение (например, uptime). Потом я создаю dependent item и добавляю обработку через preprocessing: использую Regex, чтобы оставить только числовое значение.

---

## 4. Визуализация и дашборды

Чтобы видеть метрики наглядно, я создаю общий график, на который добавляю CPU и RAM. Я делаю это через *Monitoring - Graphs - Create graph*.

После этого я создаю собственный Dashboard. Я добавляю туда:

* график CPU+RAM,
* виджет Top 5 процессов (если данные доступны),
* сводку тревог.

Дашборд я создаю через *Monitoring - Dashboards - Create dashboard*.

Скрин вставляю сюда: 

**![\[ДАШБОРД\]](img/dashboard.png)**

---

## 5. Условные оповещения и действия

Я настраиваю уведомление, которое отправляется только тогда, когда одновременно выполняются два условия: CPU Load больше 2 и RAM Used больше 80%. Для этого я создаю действие через *Configuration - Actions* и задаю условия с логикой AND.

---

## 6. Экспорт и документирование

В конце работы я экспортирую свой шаблон в формате XML через *Configuration - Templates - Export*.

XML:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.4</version>
    <date>2025-02-19T13:42:55Z</date>
    <templates>
        <template>
            <template>Template IT-System-Monitoring</template>
            <name>Template IT-System-Monitoring</name>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <items>
                <item>
                ...
```

Я сохраняю журнал событий через *Monitoring - Events - Export*.

Journal:
```pgsql
2025-02-19 14:11:22  Problem detected: High load on host "dev-server-01"
2025-02-19 14:11:22  Trigger: High load (>2 for 5 minutes)
2025-02-19 14:11:22  Action executed: Send notification to Admins

2025-02-19 14:26:42  Problem resolved: High load on host "dev-server-01"
2025-02-19 14:26:42  Trigger returned to OK

2025-02-19 15:03:17  Warning: RAM usage exceeded warning threshold (80%)
2025-02-19 15:03:17  Action executed: Send notification to Admins
```

---

# Контрольные вопросы

### 1. Разница между dependent и calculated

Dependent item зависит от другого элемента данных и обрабатывает его результат. Calculated item сам считает значение по формуле из других метрик.

### 2. Как сопоставлять метрики на одном графике?

Добавить несколько элементов данных в один график. Так я могу визуально сравнивать тренды разных метрик.

### 3. Почему стоит использовать шаблоны?

Потому что шаблоны экономят время, дают общие настроек и позволяют управлять большими группами хостов сразу.

### 4. Как влияет update interval?

Если интервал маленький - сервер нагружается сильнее, но данные точнее. Если интервал большой - нагрузка меньше, но точность падает.
